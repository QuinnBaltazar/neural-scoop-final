<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flavor Data Survey â€“ Neural Scoop</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="navbar">
    <nav>
      <a href="index.html">Home</a>
      <a href="menu.html">Menu</a>
      <a href="data.html" class="active">Data</a>
      <a href="recommend.html">AI Flavor Maker</a>
      <a href="maker.html">Ice Cream Maker</a>
      <a href="profile.html">Your Flavor Profile</a>
    </nav>
  </header>

  <section class="page-header">
    <h1>Flavor Data Survey</h1>
    <p>Share your preferences so the AI can tailor flavors to you.</p>
  </section>

  <main class="data-layout">
    <div class="data-card data-note">
      <h2>Why this matters</h2>
      <p>This survey helps influence the AI flavor picker and only your survey responses will be saved and affect the model. This helps the AI be tailored to your flavor preferences.</p>
    </div>

    <div class="data-card">
      <h2>Your Flavor Profile</h2>
      <form id="data-form" class="data-form">
        <label>Favorite ice cream (type it out)
          <input type="text" name="favoriteText" placeholder="e.g., mint chip with fudge" />
        </label>

        <label>Favorite flavor family
          <select name="favorite">
            <option value="classic">Classic (vanilla, caramel)</option>
            <option value="rich">Chocolate & mocha</option>
            <option value="bright">Mint & citrus</option>
            <option value="fresh">Berry & fruit</option>
            <option value="nutty">Nutty & toasty</option>
            <option value="adventurous">Sweet-salty & experimental</option>
          </select>
        </label>

        <label>Go-to flavor from our menu
          <select name="menuFlavor">
            <option value="">Select one</option>
            <option value="Vanilla Bean">Vanilla Bean</option>
            <option value="Rich Chocolate">Rich Chocolate</option>
            <option value="Strawberry">Strawberry</option>
            <option value="Mint Chip">Mint Chip</option>
            <option value="Cookie Dough">Cookie Dough</option>
            <option value="Weekly Special">Weekly Special</option>
            <option value="Rainbow Sherbet">Rainbow Sherbet</option>
            <option value="Rocky Road">Rocky Road</option>
            <option value="Mango">Mango</option>
            <option value="Cookies and Cream">Cookies and Cream</option>
            <option value="Pistachio">Pistachio</option>
            <option value="Pineapple Coconut">Pineapple Coconut</option>
          </select>
        </label>

        <label>Preferred base
          <div class="ai-options">
            <label><input type="radio" name="base" value="cone" checked> Cone</label>
            <label><input type="radio" name="base" value="bowl"> Waffle bowl</label>
            <label><input type="radio" name="base" value="cup"> Cup</label>
          </div>
        </label>

        <label>Go-to toppings
          <div class="ai-options">
            <label><input type="checkbox" name="topping" value="Sprinkles" checked> Sprinkles</label>
            <label><input type="checkbox" name="topping" value="Hot Fudge"> Hot Fudge</label>
            <label><input type="checkbox" name="topping" value="Whipped Cream"> Whipped Cream</label>
            <label><input type="checkbox" name="topping" value="Cherries"> Cherries</label>
            <label><input type="checkbox" name="topping" value="Oreo Crumbles"> Oreo Crumbles</label>
            <label><input type="checkbox" name="topping" value="Caramel"> Caramel</label>
            <label><input type="checkbox" name="topping" value="M&Ms"> M&amp;Ms</label>
            <label><input type="checkbox" name="topping" value="Chocolate Chips"> Chocolate Chips</label>
            <label><input type="checkbox" name="topping" value="Marshmallows"> Marshmallows</label>
          </div>
        </label>

        <label>Sweetness level
          <div class="ai-options">
            <label><input type="radio" name="sweet" value="low"> Light</label>
            <label><input type="radio" name="sweet" value="med" checked> Balanced</label>
            <label><input type="radio" name="sweet" value="high"> Sweet tooth</label>
          </div>
        </label>

        <label>Texture preference
          <div class="ai-options">
            <label><input type="radio" name="texture" value="smooth" checked> Smooth</label>
            <label><input type="radio" name="texture" value="chunky"> Chunky</label>
            <label><input type="radio" name="texture" value="chewy"> Chewy</label>
          </div>
        </label>

        <label>Anything else we should know?
          <textarea name="notes" rows="3" placeholder="Allergies, favorite brand, etc."></textarea>
        </label>

        <div class="data-actions">
          <button type="submit" class="shop-primary">Save Preferences</button>
          <a class="menu-add" href="recommend.html">Go to AI Flavor Maker</a>
          <a class="menu-add" href="profile.html">View your Flavor Profile</a>
          <button type="button" id="data-clear" class="menu-add">Clear Data</button>
        </div>
        <p id="data-status" class="data-status" aria-live="polite"></p>
      </form>
    </div>

    <div class="data-card data-history-card">
      <h2>Survey History</h2>
      <p class="data-status">Recent entries are saved locally so the AI can learn.</p>
      <div id="survey-history" class="survey-history"></div>
    </div>
  </main>

  <script>
    const surveyKey = "ns_survey_prefs";
    const surveyHistoryKey = "ns_survey_history";

    function saveSurvey(pref) {
      try {
        localStorage.setItem(surveyKey, JSON.stringify(pref));
      } catch (e) {
        // ignore
      }

      try {
        const raw = localStorage.getItem(surveyHistoryKey);
        const history = raw ? JSON.parse(raw) : [];
        history.push({ ...pref, ts: Date.now() });
        localStorage.setItem(surveyHistoryKey, JSON.stringify(history.slice(-20))); // keep last 20
      } catch (e) {
        // ignore
      }
    }

    function loadSurvey() {
      try {
        const raw = localStorage.getItem(surveyKey);
        return raw ? JSON.parse(raw) : null;
      } catch (e) {
        return null;
      }
    }

    function fillForm(pref) {
      if (!pref) return;
      const form = document.getElementById("data-form");
      form.favorite.value = pref.favorite || "classic";
      form.menuFlavor.value = pref.menuFlavor || "";
      form.base.value = pref.base || "cone";
      form.sweet.value = pref.sweet || "med";
      form.texture.value = pref.texture || "smooth";
      form.favoriteText.value = pref.favoriteText || "";
      form.querySelectorAll('input[name="topping"]').forEach(cb => {
        cb.checked = pref.toppings?.includes(cb.value) || false;
      });
      form.notes.value = pref.notes || "";
    }

    function renderHistory() {
      const container = document.getElementById("survey-history");
      if (!container) return;
      let history = [];
      try {
        const raw = localStorage.getItem(surveyHistoryKey);
        history = raw ? JSON.parse(raw) : [];
      } catch (e) {
        history = [];
      }
      container.innerHTML = "";
      if (!history.length) {
        container.textContent = "No survey entries yet.";
        return;
      }
      history
        .slice()
        .reverse()
        .forEach(entry => {
          const div = document.createElement("div");
          const date = new Date(entry.ts || Date.now()).toLocaleString();
          div.className = "survey-history-item";
          div.innerHTML = `
            <div class="survey-history-top">
              <strong>${entry.favorite || "Classic"}</strong>
              <span class="survey-date">${date}</span>
            </div>
            <div class="survey-tags">
              <span>${entry.base || "cone"}</span>
              <span>${entry.sweet || "med"} sweet</span>
              <span>${entry.texture || "smooth"}</span>
            </div>
            <div class="survey-notes">${entry.favoriteText || entry.notes || ""}</div>
            <div class="survey-toppings">Toppings: ${(entry.toppings || []).join(", ") || "None"}</div>
          `;
          container.appendChild(div);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("data-form");
      const status = document.getElementById("data-status");
      const existing = loadSurvey();
      fillForm(existing);
      renderHistory();

      form.addEventListener("submit", e => {
        e.preventDefault();
        const data = new FormData(form);
        const pref = {
          favorite: data.get("favorite"),
          menuFlavor: data.get("menuFlavor"),
          base: data.get("base"),
          toppings: data.getAll("topping"),
          sweet: data.get("sweet"),
          texture: data.get("texture"),
          favoriteText: data.get("favoriteText") || "",
          notes: data.get("notes") || "",
          intensity: data.get("intensity") || "light"
        };
        saveSurvey(pref);
        status.textContent = "Saved! The AI will use this in recommendations.";
        renderHistory();
      });

      const clearBtn = document.getElementById("data-clear");
      if (clearBtn) {
        clearBtn.addEventListener("click", () => {
          try {
            localStorage.removeItem(surveyKey);
            localStorage.removeItem(surveyHistoryKey);
          } catch (e) {
            // ignore
          }
          form.reset();
          status.textContent = "Survey data cleared.";
          renderHistory();
        });
      }
    });
  </script>
</body>
</html>
